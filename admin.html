
<!DOCTYPE html>
<html>
<head>
    <title>Admin Monitor</title>
    <style>
        body {
            font-family: Arial;
            background-color: #f0f0f0;
            text-align: center;
            padding-top: 20px;
        }
        input {
            padding: 8px;
            font-size: 16px;
            margin-bottom: 12px;
        }
        video {
            width: 45%;
            margin: 10px;
            border: 2px solid #ccc;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h2>Admin Panel - Enter Password</h2>
    <input type="password" id="adminPass" placeholder="Enter password" />
    <button onclick="checkPass()">Enter</button>

    <div id="videoPanel" style="display:none;">
        <h3>Monitoring Active Chat</h3>
        <video id="local" autoplay muted playsinline></video>
        <video id="remote" autoplay playsinline></video>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const password = "chilladmin"; // Set your password here

        function checkPass() {
            const input = document.getElementById('adminPass').value;
            if (input === password) {
                document.getElementById('videoPanel').style.display = 'block';
                document.getElementById('adminPass').style.display = 'none';
                event.target.style.display = 'none';
                initAdminView();
            } else {
                alert("Incorrect password.");
            }
        }

        function initAdminView() {
            const socket = io();
            const room = 'default';
            const localVideo = document.getElementById('local');
            const remoteVideo = document.getElementById('remote');
            let localStream;
            let peerConnection;
            const config = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };

            navigator.mediaDevices.getUserMedia({ video: true, audio: true }).then(stream => {
                localStream = stream;
                localVideo.srcObject = stream;
                socket.emit('join', room);
            });

            socket.on('user-joined', id => {
                peerConnection = new RTCPeerConnection(config);
                localStream.getTracks().forEach(track => peerConnection.addTrack(track, localStream));

                peerConnection.onicecandidate = event => {
                    if (event.candidate) {
                        socket.emit('ice-candidate', { target: id, candidate: event.candidate });
                    }
                };

                peerConnection.ontrack = event => {
                    remoteVideo.srcObject = event.streams[0];
                };

                peerConnection.createOffer().then(offer => {
                    peerConnection.setLocalDescription(offer);
                    socket.emit('offer', { target: id, sdp: offer });
                });
            });

            socket.on('offer', data => {
                peerConnection = new RTCPeerConnection(config);
                localStream.getTracks().forEach(track => peerConnection.addTrack(track, localStream));

                peerConnection.setRemoteDescription(new RTCSessionDescription(data.sdp));
                peerConnection.createAnswer().then(answer => {
                    peerConnection.setLocalDescription(answer);
                    socket.emit('answer', { target: data.caller, sdp: answer });
                });

                peerConnection.ontrack = event => {
                    remoteVideo.srcObject = event.streams[0];
                };

                peerConnection.onicecandidate = event => {
                    if (event.candidate) {
                        socket.emit('ice-candidate', { target: data.caller, candidate: event.candidate });
                    }
                };
            });

            socket.on('answer', data => {
                peerConnection.setRemoteDescription(new RTCSessionDescription(data.sdp));
            });

            socket.on('ice-candidate', data => {
                peerConnection.addIceCandidate(new RTCIceCandidate(data.candidate));
            });
        }
    </script>
</body>
</html>
